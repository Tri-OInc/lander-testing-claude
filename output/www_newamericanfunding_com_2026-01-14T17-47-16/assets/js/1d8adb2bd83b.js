function checkIp(){const t=window.location.host,r=t==="www.newamericanfunding.com"||t==="localhost:5000";if(!r){var n=document.getElementById("ip-check-overlay"),i=document.getElementById("mainContent");if(!n||!i){console.warn("IP overlay or main content container not found.");return}$.ajax({url:"https://api.ipify.org?format=json",method:"GET",dataType:"json",success:function(t){var r=t.ip;console.log("User IP address:",r);$.ajax({url:"/checkIp/",method:"POST",contentType:"application/json",data:JSON.stringify({ip:r}),success:function(){n.parentNode.removeChild(n);i.style.display="block"},error:function(){n.innerHTML=`
                          <div style="text-align:center;">
                            <h1 style="color: red;">Access Denied</h1>
                            <p>Your IP is not whitelisted for this environment.</p>
                          </div>`}})},error:function(n,i,r){console.error("Failed to fetch IP address. Status:",i,r);t()}});function t(){n.innerHTML=`
              <div style="text-align:center;">
                <h1 style="color: red;">Access Denied</h1>
                <p>Could not validate your IP address.</p>
              </div>`}}}function formatphone(n){const i=(""+n).replace(/\D/g,""),t=i.match(/^(\d{3})(\d{3})(\d{4})$/);return t?`(${t[1]}) ${t[2]}-${t[3]}`:n}function utcTimeStampFormSubmit(n){console.log(n);const i=(new Date).toISOString().replace("T"," "),t=n;t.length&&t.val(i)}function pstTimeStampFormSubmit(n){console.log(n);const i=new Date,r=i.toLocaleString("en-US",{timeZone:"America/Los_Angeles",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/(\d+)\/(\d+)\/(\d+),/,"$3-$1-$2"),t=n;t.length&&t.val(r)}function updatePhoneDisplay(){var i,r;if(document.referrer&&document.referrer.includes("/mortgage-loans")){var u=document.referrer,n=u.split("/"),f=n.indexOf("mortgage-loans"),t=n[f+1];if(t){let n=window.Agents.filter(n=>n.agentPageName.toLowerCase()==t.toLowerCase());displaynumber(n[0].mobilePhoneNumber);localStorage.getItem("phoneDisplayglobal")===null&&(i=document.querySelector(".global-phone").innerHTML,r=i.replace(/[^0-9]/g,""),localStorage.setItem("phoneDisplayglobal",r));localStorage.setItem("phoneDisplay",n[0].mobilePhoneNumber)}}window.location.href.toLocaleLowerCase().includes("/myloan")||window.location.href.toLocaleLowerCase().includes("/careers")||window.location.href.toLowerCase().includes("/reverse/")?displaynumber(localStorage.getItem("phoneDisplayglobal")):localStorage.getItem("phoneDisplay")&&displaynumber(localStorage.getItem("phoneDisplay"))}function displaynumber(n){var t=n,i=localStorage.getItem("reversephoneDisplay");window.innerWidth>768?($(".phone-display").not("header.reverse .phone-display").each(function(){$(this).attr("href","tel:"+t).text(formatPhoneNumber(t))}),$(".getQuoteModule a.mod-quote-phone").each(function(){$(this).attr("href","tel:+1-"+formatPhoneNumberHiphen(t)).text("CALL US "+formatPhoneNumber(t))})):($(".phone-display").not("header.reverse .phone-display").each(function(){$(this).attr("href","tel:"+t).html('<i class="fa-solid fa-phone d-lg-none"><\/i>')}),$(".getQuoteModule a.mod-quote-phone").each(function(){const n=formatPhoneNumberHiphen(t);$(this).attr("href","tel:+1-"+n).text(formatPhoneNumber(t))}));$(".global-phone").each(function(){var n="("+t.slice(0,3)+") "+t.slice(3,6)+"-"+t.slice(6);$(this).attr("href","tel:"+t).text(n)});i&&(console.log(i),$(".reverseguidphonenumber").each(function(){var n="("+i.slice(0,3)+") "+i.slice(3,6)+"-"+i.slice(6);$(this).attr("href","tel:"+i).attr("title",n).text(n)}),$("header.reverse a.phone-display").each(function(){var n="("+i.slice(0,3)+") "+i.slice(3,6)+"-"+i.slice(6);window.innerWidth>768?$(this).attr("href","tel:"+i).text(n):$(this).attr("href","tel:"+i).html('<i class="fa-solid fa-phone d-lg-none"><\/i>')}))}function updateLOid(n){let t=window.Agents.filter(t=>t.agentUID==n);t[0]&&(localStorage.setItem("agentid",t[0].agentUID),localStorage.setItem("phoneDisplay",t[0].mobilePhoneNumber),localStorage.setItem("reversephoneDisplay",t[0].mobilePhoneNumber))}function initialize(){window.queryStringVariables=location.search?location.search.slice(1).split("&").reduce(splitSearchToKeyValuePair,{}):{};$(".btn-search").on("click",function(){toggleSearchBar()});$(".btn-lo-search").on("click",redirectToSearchPage);$(".btn-lo-search").on("touch",redirectToSearchPage);Array.from(document.querySelectorAll('[name="txtLoSearchField"]')).forEach(function(n){n.addEventListener("keydown",enterForClick);n.addEventListener("keydown",filterNonSpaceHyphenAlphabetical);n.addEventListener("keydown",filterBeginningNonAlphabetical);n.addEventListener("keyup",searchAutocomplete);n.addEventListener("keypress",filterRepeatSpacesAndHyphens)});Array.from(document.querySelectorAll('[name="ddlSearchType"]')).forEach(function(n){n.addEventListener("click",function(n){toggleChevron(n.target.attributes["data-guid"].value)});n.addEventListener("keydown",function(n){toggleChevron(n.target.attributes["data-guid"].value)});n.addEventListener("blur",function(n){toggleChevron(n.target.attributes["data-guid"].value,!1)})});$(".search-bar-activator").on("click touch",function(n){switchSearchType(n);toggleSearchBar(!0)});$(".search-bar-mobile-closer").on("click touch",function(){toggleSearchBar(!1)});var{type:n,search:t}=queryStringVariables;n&&$('[name="ddlSearchType"]').val(n);t&&$('main [name="txtLoSearchField"]').val(t);$("#loSearchBar #txtLoSearchField").val("")}function toggleChevron(n,t=null){var i=$('#btnDropDown[data-guid="'+n+'"] i'),t=t||i.hasClass("fa-chevron-down");t?i.removeClass("fa-chevron-down").addClass("fa-chevron-up"):i.removeClass("fa-chevron-up").addClass("fa-chevron-down")}function splitSearchToKeyValuePair(n,t,i,r,[u,f]=t.split("=")){return n[u]=decodeURIComponent(f),n}function switchSearchType(n){var t=document.querySelector("#ddlSearchType"),i=n.target.attributes["data-search-type"].value;t.value=i}function toggleSearchBar(n){$("#loSearchBar")[0].style.visibility="visible";n==null&&(n=$("#loSearchBar").hasClass("collapser"));$("#loSearchBar").removeClass(n?"collapser":"expand");$("#loSearchBar").addClass(n?"expand":"collapser");n?$('div [name="ddlSearchType"], div [name="txtLoSearchField"]').attr("tabindex",""):$('div [name="ddlSearchType"], div [name="txtLoSearchField"]').attr("tabindex","-1")}function detectAutocompleteBlurAndHide(n){var t=Array.from(document.querySelectorAll(".search-bar-autocomplete")),i=t.reduce(function(n,t){return n.concat(t).concat(Array.from(t.children))},[]);i.includes(n.target)||t.forEach(function(n){clearSearchAutocomplete(n.attributes["data-guid"].value)})}function clearSearchAutocomplete(n){var t=$('.search-bar-autocomplete[data-guid="'+n+'"]')[0];t.innerHTML="";t.classList.add("visually-hidden")}function searchAutocomplete(n){var t=n.target.attributes["data-guid"].value;if(!validateMinimum2Characters(t)){clearSearchAutocomplete(t);return}var i=$('#ddlSearchType[data-guid="'+t+'"]').val(),u=new RegExp(n.target.value,"gi"),f=i=="lo"?window.Agents.filter(filterAgents.bind(this,u)):window.Branches.filter(filterBranches.bind(this,u)),r=$('.search-bar-autocomplete[data-guid="'+t+'"]')[0];r.innerHTML="";f.length>0?r.classList.remove("visually-hidden"):r.classList.add("visually-hidden");f.slice(0,5).map(function(n){var u=i=="lo"?"https://newamericanfunding.com/mortgage-loans/"+n.agentPageName:"https://newamericanfunding.com/branches/"+n.subDomain,f=i=="lo"?n.firstName+" "+n.lastName:n.name,e=i=="lo"?n.mobilePhoneNumber:n.phone.replace(/[^0-9]/g,"");r.appendChild(createSearchResultListItem(f,u,t,e))})}function enterForClick(n){var t=n.target.attributes["data-guid"].value;n.key=="Enter"&&$('#btnLoSearch[data-guid="'+t+'"]')[0].click()}function spaceBarForClick(n){if(n.key==" ")return n.target.click(),killEvent(n)}function clearSearchAutocompleteOnEscape(n){var t=n.target.attributes["data-guid"].value;n.key=="Escape"&&clearSearchAutocomplete(t)}function createSearchResultListItem(n,t,i,r){var u=document.createElement("a"),f;return u.href=t,u.setAttribute("tabindex","0"),u.addEventListener("keydown",spaceBarForClick),u.addEventListener("keydown",clearSearchAutocompleteOnEscape),u.setAttribute("data-guid",i),r&&u.setAttribute("onclick","loclicked("+r+")"),f=document.createElement("li"),f.innerText=n,f.classList.add("search-result"),f.setAttribute("tabindex","-1"),u.appendChild(f),u}function filterAgents(n,{firstName:t,lastName:i}){return(t+" "+i).match(n)}function filterBranches(n,{name:t}){return t.match(n)}function killEvent(n){return n.stopPropagation(),n.preventDefault(),!1}function redirectToSearchPage(n){killEvent(n);var t=n.target.attributes["data-guid"].value,i=$('#txtLoSearchField[data-guid="'+t+'"]'),r=$('#btnLoSearch[data-guid="'+t+'"]'),f=$('#txtLoSearchField[data-guid="'+t+'"]').val(),e=$('#ddlSearchType[data-guid="'+t+'"]').val(),u=$('.search-error[data-guid="'+t+'"]');if(validateMinimum2Characters(t))i[0].style.border="",r[0].style.border="",u.html("");else return i[0].style.border="1px solid red",r[0].style.border="1px solid red",u.html("Minimum 2 characters required."),killEvent(n);window.location.href="/search-results/?search="+f+"&type="+e}function validateMinimum2Characters(n){var t=$('#txtLoSearchField[data-guid="'+n+'"]').val();return t.replace(/ |-/g,"").length>=2}function validateNoBeginningDash(n){var t=$('#txtLoSearchField[data-guid="'+n+'"]').val();return!t.match(/^-/)}function filterRepeatSpacesAndHyphens({key:n,target:{selectionStart:i,selectionEnd:t,value:r}}){if(n.match(/ |-/)&&i==t&&i>1&&r[i-1]==n)return killEvent(event)}function filterNonSpaceHyphenAlphabetical(n){if(!n.key.match(/ |-|[a-z]/gi))return killEvent(n)}function filterBeginningNonAlphabetical(n){if(n.key.match(/ |-/)&&n.target.value=="")return killEvent(n)}function loclicked(n){localStorage.setItem("phoneDisplay",n)}function agentsearchclick(n){localStorage.setItem("phoneDisplay",n);updatePhoneDisplay()}$(document).ready(function(){const n=$("form[data-f-metadata='certified-register-form']");n.parsley();$("form[data-f-metadata=certified-register-form] button").click(function(){typeof $$epiforms!="undefined"&&$$epiforms(function(){$$epiforms(".EPiServerForms").on("formsStepValidating",function(t){const i=n.parsley(),r=i.validate();r?window.open("https://www.eventbrite.com/o/115691000551","_blank"):t.preventDefault()})})})});window.addEventListener("DOMContentLoaded",checkIp);const urlParams=new URLSearchParams(window.location.search),refinanceRaw=urlParams.get("refinance"),purchaseRaw=urlParams.get("purchase"),phoneRaw=urlParams.get("phone"),gclidRaw=urlParams.get("gclid"),guidRaw=urlParams.get("guid"),fullUrl=window.location.href,currentDateTime=(new Date).toUTCString(),isValidNumber=n=>/^\d+$/.test(n),hasValidData=n=>n!==null&&n!==undefined&&n!=="",setLocalStorage=(n,{refinance:e,purchase:f,phone:u,url:o,date:t,gclid:i,guid:r})=>{localStorage.setItem(`${n}pageurl`,o),localStorage.setItem(`${n}refinance`,e||""),localStorage.setItem(`${n}purchase`,f||""),localStorage.setItem(`${n}date`,t),localStorage.setItem(`${n}phone`,u||""),localStorage.setItem(`${n}guid`,r||""),localStorage.setItem("phoneDisplay",u||""),localStorage.setItem("reversephoneDisplay",r||""),localStorage.setItem("gclid",i||"")},guidPhoneMap=window.guidPhoneMap||{},isValidPhone=phoneRaw&&isValidNumber(phoneRaw)&&phoneRaw.length===10;let phoneToUse=isValidPhone?phoneRaw:null;hasValidData(guidRaw)&&guidPhoneMap[guidRaw]?phoneToUse=guidPhoneMap[guidRaw]:isValidPhone&&(phoneToUse=phoneRaw);hasValidData(guidRaw)&&guidPhoneMap[guidRaw]&&localStorage.setItem("reversephoneDisplay",guidPhoneMap[guidRaw]);const isValidRefinance=refinanceRaw&&isValidNumber(refinanceRaw),isValidPurchase=purchaseRaw&&isValidNumber(purchaseRaw),prefix=isValidRefinance&&isValidPurchase&&hasValidData(localStorage.getItem("PPC_FT_refinance"))&&hasValidData(localStorage.getItem("PPC_FT_purchase"))?"PPC_LT_":"PPC_FT_";if(isValidRefinance&&isValidPurchase?setLocalStorage(prefix,{refinance:refinanceRaw,purchase:purchaseRaw,phone:isValidPhone?phoneRaw:null,url:fullUrl,date:currentDateTime,gclid:hasValidData(gclidRaw)?gclidRaw:"",guid:hasValidData(guidRaw)?guidRaw:""}):isValidRefinance||isValidPurchase?setLocalStorage(prefix,{refinance:isValidRefinance?refinanceRaw:"",purchase:isValidPurchase?purchaseRaw:"",phone:isValidPhone?phoneRaw:null,url:fullUrl,date:currentDateTime,gclid:hasValidData(gclidRaw)?gclidRaw:"",guid:hasValidData(guidRaw)?guidRaw:""}):isValidPhone&&localStorage.setItem("phoneDisplay",phoneRaw),hasValidData(guidRaw)){const n=hasValidData(localStorage.getItem("PPC_FT_guid"))?"PPC_LT_":"PPC_FT_";localStorage.setItem(`${n}guid`,guidRaw);localStorage.setItem(`${n}pageurl`,fullUrl);localStorage.setItem(`${n}date`,currentDateTime)}var referrer=document.referrer;referrer!=""&&referrer.includes("newamericanfunding.com")||localStorage.getItem("FirstVisitToLO")||localStorage.setItem("FirstVisitToNAF",!0);$('.section-block a[href*="#"]:not([href="#"]), .content-block a[href*="#"]:not([href="#"])').click(function(){var n;if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname&&(n=$(this.hash),n=n.length?n:$("[name="+this.hash.slice(1)+"]"),n.length))return $("html, body").animate({scrollTop:n.offset().top+-135},100),!1});const $prolocareerform=$("form[data-f-metadata='apply-prolo-program-forms']");if($prolocareerform.length){const t=$prolocareerform.find('button[type="submit"]'),i=$prolocareerform.parsley(),n=$prolocareerform.find(".FormTextbox:nth-child(8) input");pstTimeStampFormSubmit(n);t.on("click",function(){i.validate();pstTimeStampFormSubmit(n)})}const formatPhoneNumber=n=>`(${n.slice(0,3)}) ${n.slice(3,6)}-${n.slice(6)}`,formatPhoneNumberHiphen=n=>`${n.slice(0,3)}-${n.slice(3,6)}-${n.slice(6)}`;window.onload=updatePhoneDisplay;window.onresize=updatePhoneDisplay;document.body.addEventListener("click",detectAutocompleteBlurAndHide);document.onreadystatechange=function(){if(document.readyState=="interactive"&&(setTimeout(initialize),localStorage.getItem("phoneDisplayglobal")===null)){var n=document.querySelector(".global-phone").innerHTML,t=n.replace(/[^0-9]/g,"");localStorage.setItem("phoneDisplayglobal",t)}};const currentUrl=window.location.href,referringUrl=document.referrer,isReferringUrlValid=referringUrl&&!referringUrl.includes("newamericanfunding.com"),hasPPCData=hasValidData(localStorage.getItem("PPC_FT_purchase"))||hasValidData(localStorage.getItem("PPC_FT_refinance"))||hasValidData(localStorage.getItem("PPC_LT_purchase"))||hasValidData(localStorage.getItem("PPC_LT_refinance")),validPaths=["/about","/apply-now","/blog","/buy-a-house","/calculators","/first-time-homebuyer","/latino-focus","/learning-center","/loan-types","/mortgage-resources","/mortgage-rates","/new-american-dream","/refinance","/quitclaim-property-transfer","/services","/smart-start-home-buyer","/trending"],currentPath=new URL(currentUrl).pathname,isValidPath=validPaths.some(n=>currentPath.startsWith(n));isReferringUrlValid&&isValidPath&&(hasPPCData?localStorage.setItem("PostSeoEntrancePage",currentUrl):(localStorage.setItem("PriorSeoEntrancePage",currentUrl),localStorage.setItem("Path_Entrance_URL",currentUrl),localStorage.setItem("Path_External_URL",referringUrl),localStorage.setItem("phoneDisplay","8552763747")));$(document).ready(function(){const t=$("form[data-f-metadata='uqual-contact-form']"),i=t.find(".FormTextbox:nth-child(7) input"),n=t.find('button[type="submit"]');i.on("input",function(){let n=$(this).val();const t=$(this);if(n!==""){n=n.replace(/\D/g,"");let i=parseInt(n,10);if(isNaN(i)){t.val("0");return}i>9999999&&(i=1e7);n=i.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");t.val(n);const r=n.replace(/,/g,""),u=t.parsley();r.length>=5&&u.removeError("minLengthCustom")}else{const n=t.parsley();n.removeError("minLengthCustom")}});i.on("blur",function(){const r=$(this).val(),t=$(this).parsley(),i=r.replace(/,/g,"");i.length<5&&i!==""?(t.removeError("minLengthCustom"),t.addError("minLengthCustom",{message:"This value is too short. It should have 6 characters or more.",updateClass:!0}),n.prop("disabled",!0)):(t.removeError("minLengthCustom"),n.prop("disabled",!1))});n.on("click",function(){const i=grecaptcha.getResponse(),r=i.length>0;t.parsley().validate()&&r&&(n.text("Submitting..."),n.prop("disabled",!0),n.addClass("submitting"))})});